<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Add Feedback - FNL Studio</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #e2e8f0;
      text-align: center;
      padding: 20px;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .logo img {
      width: 200px;
      height: auto;
      margin-bottom: 30px;
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
    }
    h1 {
      font-size: 1.5em;
      margin: 15px 0;
      color: #f1f5f9;
      font-weight: 600;
    }
    .feedback-form {
      background-color: #1e293b;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      max-width: 400px;
      width: 90%;
      text-align: left;
    }
    .feedback-form label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #f1f5f9;
    }
    .feedback-form textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: none;
      border-radius: 10px;
      background-color: #2d3b4e;
      color: #e2e8f0;
      font-size: 14px;
      resize: vertical;
    }
    .star-rating {
      font-size: 2em;
      margin-bottom: 15px;
      cursor: pointer;
    }
    .star-rating span {
      transition: transform 0.3s, color 0.3s;
    }
    .star-rating span.filled {
      color: #f59e0b; /* Filled gold */
      transform: scale(1.2); /* Blow up effect */
    }
    .star-rating span.outline {
      color: #4b5e6d; /* Outline color */
    }
    .submit-button {
      background-color: #10b981;
      padding: 12px 30px;
      border: none;
      border-radius: 10px;
      color: white;
      cursor: pointer;
      font-weight: 600;
      font-size: 16px;
      transition: background-color 0.3s, transform 0.2s;
    }
    .submit-button:hover {
      background-color: #059669;
      transform: translateY(-2px);
    }
    .back-button {
      background-color: #4a5b6f;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      color: #e2e8f0;
      cursor: pointer;
      font-weight: 600;
      margin-top: 10px;
      transition: background-color 0.3s, transform 0.2s;
    }
    .back-button:hover {
      background-color: #3a4b5f;
      transform: translateY(-2px);
    }
    .footer {
      margin-top: auto;
      padding: 20px;
      background-color: #0f172a;
      width: 100%;
      text-align: center;
      border-top: 1px solid #2d3b4e;
    }
    .error-message { color: #ef4444; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="logo">
    <img src="https://i.postimg.cc/kX2rSgJw/20250414-095948.png" alt="FNL Studio Logo" />
  </div>
  <h1>Add Feedback</h1>
  <div class="feedback-form" id="feedbackForm">
    <label>Rating:</label>
    <div class="star-rating" id="starRating">
      <span onclick="setRating(1)">ðŸŒŸ</span>
      <span onclick="setRating(2)">ðŸŒŸ</span>
      <span onclick="setRating(3)">ðŸŒŸ</span>
      <span onclick="setRating(4)">ðŸŒŸ</span>
      <span onclick="setRating(5)">ðŸŒŸ</span>
    </div>
    <label for="caption">Feedback Caption:</label>
    <textarea id="caption" rows="4" required></textarea>
    <button class="submit-button" onclick="submitFeedback()">Submit</button>
  </div>
  <button class="back-button" onclick="window.location.href='feedback.html'">Back</button>
  <div class="footer">
    <h3>About Us</h3>
    <p>Welcome to FNL Studio â€“ a creative collaboration between Light Editz and Flash Editz. We're passionate about visual storytelling and dedicated to providing high-quality, professional-grade presets for photo and video editors. Whether you're just starting out or you're a seasoned creator, our presets are crafted to give your content a unique, polished look with just a few clicks.</p>
    <h3>Copyright Â©</h3>
    <p>Â© 2025 FNL Studio. All rights reserved. All content on this website, including presets, visuals, and text, is the intellectual property of FNL Studio and is protected by copyright laws. Any unauthorized use, reproduction, or distribution of our materials is strictly prohibited.</p>
  </div>
  <div id="errorMessage" class="error-message"></div>

  <script>
    const BIN_ID = "67fccb0b8960c979a584b5d5";
    const MASTER_KEY = "$2a$10$PlYW4zt8k/Be46UjnPgRSex64CZn7Sk7ifMW09AgYaT1.jS2pwjnO";
    const API_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
    const errorMessage = document.getElementById("errorMessage");
    let rating = 0;
    const userName = localStorage.getItem("userName") || "Anonymous"; // Assuming name is stored in localStorage from join.html

    function setRating(value) {
      rating = value;
      const stars = document.getElementById("starRating").getElementsByTagName("span");
      for (let i = 0; i < stars.length; i++) {
        stars[i].classList.remove("filled", "outline");
        if (i < value) {
          stars[i].classList.add("filled");
        } else {
          stars[i].classList.add("outline");
        }
      }
      document.getElementById("caption").focus(); // Jump to caption input
    }

    async function submitFeedback() {
      const caption = document.getElementById("caption").value.trim();

      if (!caption || rating === 0) {
        errorMessage.textContent = "Please select a rating and provide a caption.";
        return;
      }

      try {
        const response = await fetch(API_URL + "/latest", { headers: { "X-Master-Key": MASTER_KEY } });
        const data = await response.json();
        const feedbacks = data.record.feedbacks || [];
        feedbacks.push({ name: userName, rating, caption, liked: false });
        await fetch(API_URL, {
          method: "PUT",
          headers: { "X-Master-Key": MASTER_KEY, "Content-Type": "application/json" },
          body: JSON.stringify({ ...data.record, feedbacks })
        });
        alert("Feedback submitted successfully!");
        window.location.href = "feedback.html";
      } catch (error) {
        console.error("Error submitting feedback:", error);
        errorMessage.textContent = "Error submitting feedback: " + error.message;
      }
    }

    window.onload = () => {
      document.getElementById("feedbackForm").addEventListener("submit", (e) => {
        e.preventDefault();
        submitFeedback();
      });
    };
  </script>
</body>
</html>
