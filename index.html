<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FNL STUDIO</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom right, #0f172a, #1e293b);
      color: white;
      text-align: center;
      padding: 30px;
    }
    .logo img { width: 200px; height: auto; margin-top: 40px; }
    .tagline { font-size: 20px; margin: 10px 0 30px; }
    .add-button { margin: 30px 0; background-color: #10b981; padding: 12px 25px; border: none; border-radius: 10px; font-size: 16px; color: white; cursor: pointer; }
    #message { margin-top: 10px; font-weight: bold; }
    .preset-card { background-color: #111827; border-radius: 20px; padding: 10px; margin: 20px auto; width: 90%; max-width: 400px; display: flex; align-items: center; justify-content: space-between; }
    .preset-card img { border-radius: 12px; width: 100px; height: 100px; object-fit: cover; }
    .preset-info { flex: 1; text-align: left; margin-left: 15px; }
    .preset-info h3 { margin: 5px 0; }
    .preset-card button { margin-top: 5px; padding: 5px 10px; background-color: #3b82f6; border: none; border-radius: 6px; color: white; cursor: pointer; }
    .feedback-section { margin-top: 30px; }
    .feedback-card { background-color: #111827; border-radius: 10px; padding: 10px; margin: 10px auto; max-width: 400px; text-align: left; }
    .feedback-card .rating { color: #ffd700; }
    .read-all { margin-top: 20px; background-color: #ef4444; padding: 10px 20px; border: none; border-radius: 5px; color: white; cursor: pointer; }
    .about { margin-top: 50px; border-top: 1px solid #444; padding-top: 30px; font-size: 14px; color: #ccc; max-width: 800px; margin-left: auto; margin-right: auto; }
  </style>
</head>
<body>
  <div class="logo">
    <img src="https://i.postimg.cc/placeholder/logo.png" alt="FNL Studio Logo" /> <!-- Replace with your logo URL -->
  </div>
  <div class="tagline">Capturing Creativity</div>
  <button class="add-button" onclick="checkCode('add')">Add Preset</button>
  <div id="message"></div>
  <div id="presetList"></div>
  <div class="feedback-section">
    <h2>Customer Feedback</h2>
    <div id="feedbackList"></div>
    <button class="read-all" onclick="window.location.href='login.html'">Read All Feedback</button>
  </div>
  <div class="about">
    <h2>About Us</h2>
    <p>Welcome to FNL Studio – a creative collaboration between Light Editz and Flash Editz. We're passionate about visual storytelling and dedicated to providing high-quality, professional-grade presets for photo and video editors. Whether you're just starting out or you're a seasoned creator, our presets are crafted to give your content a unique, polished look with just a few clicks.</p>
    <br />
    <h3>© 2025 FNL Studio. All rights reserved.</h3>
    <p>All content on this website, including presets, visuals, and text, is the intellectual property of FNL Studio and is protected by copyright laws. Any unauthorized use, reproduction, or distribution of our materials is strictly prohibited.</p>
    <p>After buying a preset, follow the payment instructions on the payment page and DM us on Instagram @fnl_studio_ with proof!</p>
  </div>

  <script>
    const BIN_ID = "67fccb0b8960c979a584b5d5";
    const MASTER_KEY = "$2a$10$PlYW4zt8k/Be46UjnPgRSex64CZn7Sk7ifMW09AgYaT1.jS2pwjnO";
    const API_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;

    function checkCode(action, index = null) {
      const code = prompt("Enter collaborator code:");
      if (code === "NEWCODE") { // Replace NEWCODE with your new code (e.g., "studio123")
        if (action === "add") {
          window.location.href = "upload.html";
        } else if (action === "edit" && index !== null) {
          editPreset(index);
        } else if (action === "delete" && index !== null) {
          deletePreset(index);
        }
      } else {
        document.getElementById("message").textContent = "You are not the collaborator.";
        document.getElementById("message").style.color = "red";
        setTimeout(() => {
          document.getElementById("message").textContent = "";
        }, 3000);
      }
    }

    async function loadPresets() {
      try {
        const response = await fetch(API_URL + "/latest", {
          headers: { "X-Master-Key": MASTER_KEY }
        });
        if (!response.ok) throw new Error("Failed to fetch presets");
        const data = await response.json();
        const presets = data.record.presets || [];
        const container = document.getElementById("presetList");
        container.innerHTML = "";

        presets.forEach((preset, index) => {
          const card = document.createElement("div");
          card.className = "preset-card";
          card.innerHTML = `
            <img src="${preset.thumbnail}" alt="Thumbnail">
            <div class="preset-info">
              <h3>${preset.name}</h3>
              <p>Price: ₹${preset.price}</p>
              <button onclick="checkCode('edit', ${index})">Edit</button>
              <button onclick="checkCode('delete', ${index})" style="background-color: #ef4444;">Delete</button>
              <a href="payment.html?price=${preset.price}">
                <button style="background-color: #10b981; margin-top: 5px;">Buy Now</button>
              </a>
            </div>
          `;
          container.appendChild(card);
        });
      } catch (error) {
        console.error("Error loading presets:", error);
        document.getElementById("message").textContent = "Failed to load presets.";
        document.getElementById("message").style.color = "red";
      }
    }

    async function loadFeedback() {
      try {
        const response = await fetch(API_URL + "/latest", {
          headers: { "X-Master-Key": MASTER_KEY }
        });
        if (!response.ok) throw new Error("Failed to fetch feedback");
        const data = await response.json();
        const feedbacks = data.record.feedbacks || [];
        const feedbackList = document.getElementById("feedbackList");
        feedbackList.innerHTML = "";
        // Sort by timestamp (latest first), limit to 5
        feedbacks.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).slice(0, 5).forEach(feedback => {
          const card = document.createElement("div");
          card.className = "feedback-card";
          card.innerHTML = `
            <p><strong>${feedback.name}</strong> (${feedback.rating}⭐)</p>
            <p>${feedback.comment}</p>
          `;
          feedbackList.appendChild(card);
        });
      } catch (error) {
        console.error("Error loading feedback:", error);
      }
    }

    async function editPreset(index) {
      try {
        const response = await fetch(API_URL + "/latest", {
          headers: { "X-Master-Key": MASTER_KEY }
        });
        if (!response.ok) throw new Error("Failed to fetch presets");
        const data = await response.json();
        const presets = data.record.presets || [];
        const preset = presets[index];

        const newName = prompt("Edit Preset Name:", preset.name);
        const newPrice = prompt("Edit Price:", preset.price);
        const newThumbnail = prompt("Edit Thumbnail URL:", preset.thumbnail);

        if (newName && newPrice && newPrice) {
          presets[index] = { name: newName, price: newPrice, thumbnail: newThumbnail };
          const updateResponse = await fetch(API_URL, {
            method: "PUT",
            headers: {
              "X-Master-Key": MASTER_KEY,
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ presets, feedbacks: data.record.feedbacks || [] })
          });
          if (!updateResponse.ok) throw new Error("Failed to update preset");
          loadPresets();
          alert("Preset updated successfully!");
        }
      } catch (error) {
        console.error("Error editing preset:", error);
        alert("Error updating preset.");
      }
    }

    async function deletePreset(index) {
      if (confirm("Are you sure you want to delete this preset?")) {
        try {
          const response = await fetch(API_URL + "/latest", {
            headers: { "X-Master-Key": MASTER_KEY }
          });
          if (!response.ok) throw new Error("Failed to fetch presets");
          const data = await response.json();
          const presets = data.record.presets || [];
          presets.splice(index, 1);
          const updateResponse = await fetch(API_URL, {
            method: "PUT",
            headers: {
              "X-Master-Key": MASTER_KEY,
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ presets, feedbacks: data.record.feedbacks || [] })
          });
          if (!updateResponse.ok) throw new Error("Failed to delete preset");
          loadPresets();
          alert("Preset deleted successfully!");
        } catch (error) {
          console.error("Error deleting preset:", error);
          alert("Error deleting preset.");
        }
      }
    }

    window.onload = () => { loadPresets(); loadFeedback(); };
  </script>
</body>
</html>
