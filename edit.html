<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit Preset - FNL Studio</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f2f2f7;
      --text: #1a1a1a;
      --accent: #e0e7ff;
      --highlight: #5b5fc7;
      --hover: #4f46e5;
    }

    [data-theme="dark"] {
      --bg: #111827;
      --text: #e5e7eb;
      --accent: #1f2937;
      --highlight: #93c5fd;
      --hover: #60a5fa;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      transition: background-color 0.6s ease, color 0.6s ease;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg);
      color: var(--text);
      padding: 2rem;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 3rem;
    }

    .logo img {
      height: 40px;
    }

    nav a {
      margin-left: 2rem;
      text-decoration: none;
      color: var(--text);
      font-weight: 600;
      transition: color 0.3s ease;
      cursor: pointer;
    }

    nav a:hover {
      color: var(--hover);
    }

    main {
      max-width: 600px;
      margin: 0 auto;
      background: var(--accent);
      padding: 2rem;
      border-radius: 14px;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 2rem;
      text-align: center;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
      background-color: var(--bg);
      color: var(--text);
    }

    .btn {
      display: inline-block;
      padding: 0.75rem 2rem;
      background-color: var(--highlight);
      color: var(--bg);
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
      transition: background-color 0.4s ease, transform 0.3s ease;
      cursor: pointer;
      border: none;
      margin-right: 1rem;
    }

    .btn:hover {
      background-color: var(--hover);
      transform: scale(1.05);
    }

    .btn.cancel {
      background-color: #888;
    }

    .btn.cancel:hover {
      background-color: #666;
    }

    .error-message {
      color: #ef4444;
      margin-top: 1rem;
      font-size: 1rem;
      text-align: center;
    }

    footer {
      margin-top: 4rem;
      text-align: center;
      font-size: 0.9rem;
      color: var(--text);
    }

    footer h2 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    footer p {
      font-size: 1rem;
      max-width: 600px;
      margin: 0 auto 1rem;
    }

    .copyright {
      color: #888;
      margin-top: 2rem;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <img src="https://i.postimg.cc/52SYd9y2/fnl-studio-logo.png" alt="FNL Studio Logo" onerror="this.src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAGFBMVEUAAAD///8AAAD/AAD/////AAAA/wD//wC3K4xiAAAAB3RSTlMA/4D/gP+Av4CXUwAAAEhJREFUeAHtkkEKwCAMBENR+v9fO8gJLNskK6ZQsYEBuA3XgU8iEskkmUwqR2AymWSSSSaTZmAymWSSSSaTZmAymWSSSSaTZmD4BTwBBj2rKmcAAAAASUVORK5CYII=';">
    </div>
    <nav>
      <a href="index.html">Home</a>
      <a href="presets.html">Presets</a>
    </nav>
  </header>

  <main>
    <h1>Edit Preset</h1>
    <form id="editForm">
      <div class="form-group">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required>
      </div>
      <div class="form-group">
        <label for="price">Price (₹):</label>
        <input type="number" id="price" name="price" required>
      </div>
      <div class="form-group">
        <label for="download_url">Download URL:</label>
        <input type="url" id="download_url" name="download_url" required>
      </div>
      <div class="form-group">
        <label for="thumbnail_url">Thumbnail URL:</label>
        <input type="url" id="thumbnail_url" name="thumbnail_url" required>
      </div>
      <div class="form-group">
        <label for="sample1">Sample 1 (optional):</label>
        <input type="url" id="sample1" name="sample1">
      </div>
      <div class="form-group">
        <label for="sample2">Sample 2 (optional):</label>
        <input type="url" id="sample2" name="sample2">
      </div>
      <div class="form-group">
        <label for="sample3">Sample 3 (optional):</label>
        <input type="url" id="sample3" name="sample3">
      </div>
      <button type="submit" class="btn">Save</button>
      <a href="index.html" class="btn cancel">Cancel</a>
    </form>
    <div id="errorMessage" class="error-message"></div>
  </main>

  <footer>
    <div class="about-us">
      <h2>About Us</h2>
      <p>Welcome to FNL Studio – a creative collaboration between Light Editz and Flash Editz. We're passionate about visual storytelling and dedicated to providing high-quality, professional-grade presets for photo and video editors. Whether you're just starting out or you're a seasoned creator, our presets are crafted to give your content a unique, polished look with just a few clicks.</p>
    </div>
    <div class="copyright">
      <p>© 2025 FNL Studio. All rights reserved.</p>
      <p>All content on this website, including presets, visuals, and text, is the intellectual property of FNL Studio and is protected by copyright laws. Any unauthorized use, reproduction, or distribution of our materials is strictly prohibited.</p>
    </div>
  </footer>

  <script>
    const BIN_ID = "67fccb0b8960c979a584b5d5";
    const MASTER_KEY = "$2a$10$PlYW4zt8k/Be46UjnPgRSex64CZn7Sk7ifMW09AgYaT1.jS2pwjnO";
    const API_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
    const form = document.getElementById("editForm");
    const errorMessage = document.getElementById("errorMessage");

    // Load theme from localStorage
    const root = document.documentElement;
    const currentTheme = localStorage.getItem("theme") || "dark";
    root.setAttribute("data-theme", currentTheme);

    // Get preset data from URL
    const urlParams = new URLSearchParams(window.location.search);
    const presetData = JSON.parse(decodeURIComponent(urlParams.get("preset")));

    // Populate form with existing preset data
    if (presetData) {
      document.getElementById("name").value = presetData.name || "";
      document.getElementById("price").value = presetData.price || "";
      document.getElementById("download_url").value = presetData.download_url || "";
      document.getElementById("thumbnail_url").value = presetData.thumbnail_url || "";
      document.getElementById("sample1").value = presetData.sample1 || "";
      document.getElementById("sample2").value = presetData.sample2 || "";
      document.getElementById("sample3").value = presetData.sample3 || "";
    } else {
      errorMessage.textContent = "No preset data found. Please go back and try again.";
      form.style.display = "none";
    }

    // Handle form submission
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const updatedPreset = {
        name: document.getElementById("name").value,
        price: parseInt(document.getElementById("price").value),
        download_url: document.getElementById("download_url").value,
        thumbnail_url: document.getElementById("thumbnail_url").value,
        sample1: document.getElementById("sample1").value || "",
        sample2: document.getElementById("sample2").value || "",
        sample3: document.getElementById("sample3").value || ""
      };

      try {
        // Fetch the current presets from JSONBin
        const response = await fetch(API_URL + "/latest", {
          headers: { "X-Master-Key": MASTER_KEY }
        });
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        const presets = data.record.presets || [];

        // Find the index of the preset to update
        const presetIndex = presets.findIndex(p => p.name === presetData.name && p.price === presetData.price && p.download_url === presetData.download_url);
        if (presetIndex === -1) throw new Error("Preset not found in the database.");

        // Update the preset
        presets[presetIndex] = updatedPreset;

        // Save the updated presets back to JSONBin
        const updateResponse = await fetch(API_URL, {
          method: "PUT",
          headers: {
            "X-Master-Key": MASTER_KEY,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ presets })
        });

        if (!updateResponse.ok) throw new Error(`HTTP error! status: ${updateResponse.status}`);

        // Show success pop-up and redirect on "Okay"
        alert("Saved Successfully");
        window.location.href = "admin.html";
      } catch (error) {
        console.error("Error updating preset:", error);
        errorMessage.textContent = "Error updating preset: Please check the console for details or try again later.";
      }
    });
  </script>
</body>
</html>
